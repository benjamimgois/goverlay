# Changelog - Version 1.6.2

All notable changes made since version 1.6.1

## Theme System

### New Features
- **Light/Dark Theme Toggle**: Complete implementation of theme switching system
  - Added `themeunit.pas` with theme management functions
  - Theme preference saved to `~/.config/goverlay/goverlay.conf`
  - Moon/sun icons for theme toggle button (icons 28 and 29)
  - Theme persistence across application restarts

### Theme Improvements
- Updated all button icons to light colors for better dark theme visibility
- Fixed theme toggle button visibility and positioning
- Added color exception system for components that should maintain custom colors
- Fixed text visibility in ComboBox and TEdit controls for light theme
- Changed status label colors from clYellow to clBlue, then to clOlive in light theme
- Added light gray button color ($00E0E0E0) for light theme
- Removed duplicate theme toggle notifications
- Added `updateBitBtn` to theme color exceptions

### Components Excluded from Theme Changes
- saveBitBtn
- gupdateBitBtn
- updateBitBtn
- notificationLabel
- vkbasaltLabel
- mangohudLabel
- optiscalerLabel
- dependenciesLabel
- deckyLabel1, deckyLabel2
- optLabel1
- fakenvapi1, fakenvapi2
- fsrLabel1
- xessLabel1
- customcommandEdit
- mangohudShape, vkbasaltShape, optiscalerShape
- autodetectnvLabel, autodetectmesaLabel
- All position RadioButtons (topleft, topcenter, topright, etc.)

## MangoHud Configuration

### New Options Added
- **cpu_efficiency**: CPU efficiency metrics
- **gpu_power_limit**: GPU power limit display
- **core_type**: CPU core type identification
- **proc_vram**: Process VRAM usage
- **ftrace**: Ftrace support for kernel tracing
- **dx_api**: DirectX API version display
- **flip_efficiency**: Joules/Frame mode toggle (frames/joule ↔ joules/frame)
- **gpu_list**: Automatic multi-GPU support (adds `gpu_list=0,1` when multiple GPUs detected)

### Configuration Improvements
- Refactored config loading into single unified `LoadMangoHudConfig` function
- Refactored config saving into single unified `SaveMangoHudConfig` function
- Added file header with version and legacy_layout flag
- Added GCHANNEL (channel: stable/git) to config file header
- Fixed config loading for network, distro and session options
- Fixed frames/joule toggle for both GPU and CPU buttons
- Both `gpuframesjouleBitBtn` and `cpuframesjouleBitBtn` share same caption state

### Configuration File Format
All MangoHud configs now start with:
```
# Generated by Goverlay 1.6.2 (git/stable)
# legacy_layout=false
```

## Flatpak Support

### Build System
- Complete Flatpak manifest (`io.github.benjamimgois.goverlay.yml`)
- Updated to KDE Platform 6.10 and Qt 6.10
- Updated MangoHud to version 0.8.2
- Updated Lazarus to version 4.4
- Updated Git to version 2.48.1
- Added vkBasalt 0.3.2.10 to Flatpak build
- Added SPIRV-Headers dependency (required by vkBasalt)
- Versioned Flatpak bundle filenames: `goverlay_VERSION_CHANNEL.flatpak`
- All build script comments translated to English

### Runtime Features
- Flatpak indicator added to window caption for non-stable builds
- Global Enable controls (geLabel, geSpeedButton) hidden in Flatpak mode
- Fixed vkBasalt detection path (`/app/lib/libvkbasalt.so`)
- Unified notification system using D-Bus (works in both Flatpak and native)
- MangoHud environment variable configuration fixed
- OptiScaler installation paths adapted for Flatpak sandbox

### File System Access
- Read-write filesystem permissions for overlay configurations
- Unified ~/fgmod directory for both Flatpak and native installations
- Flatpak-aware path detection and configuration

## vkBasalt Integration

### New Features
- vkBasalt dependency checking added
- vkBasalt included in Flatpak build
- ReShade shader progress improvements
- Removed default CAS effect from initial vkBasalt config

### Bug Fixes
- Fixed vkBasalt detection path in Flatpak mode
- Fixed vkBasalt "missing" message despite working installation

## UI Improvements

### Icons and Visual Elements
- Comprehensive button icon system implemented
- Added button icons guide in `data/button_icons/README.md`
- Updated global enable button with new toggle switch icons
- Fixed icon visibility in Flatpak application menus
- Changed logo image in README.md

### Dependency Checks
- Added vkbasalt dependency check
- Improved dependency detection system
- Better error messages for missing dependencies

## OptiScaler/fgmod

### Installation System
- Replaced wget with native HTTP client (fphttpclient) for downloads
- Then replaced fphttpclient with curl for better compatibility
- Added Flatpak support for OptiScaler installation
- Fixed OptiScaler configuration paths for Flatpak environment
- Fixed OptiScaler fgmod path display for Flatpak
- Added fgmod scripts with Flatpak support
- Unified ~/fgmod directory path for all environments

### OptiScaler Configuration Updates
- **Updated for OptiScaler latest version compatibility**
- Replaced deprecated `FGType` configuration with `ShortcutKey` for overlay menu
- Added shortcut key selector with support for:
  - INSERT (auto/default)
  - F1 (0x70)
  - F2 (0x71)
  - F3 (0x72)
  - F4 (0x73)
- Updated configuration reading and writing to match new OptiScaler.ini format
- Improved error messages for configuration file validation

## Code Quality and Maintainability

### Refactoring
- Translated all code comments from Portuguese to English
- Consolidated code duplication across the codebase
- Added comprehensive variable documentation
- Added `CLAUDE.md` for AI assistant guidance
- Added centralized constants unit for URLs, paths, and configuration
- Added system detector unit to consolidate detection logic
- Added configuration manager for path and file operations

### Bug Fixes
- Fixed 'List index out of bounds' error
- Fixed memory leak in LoadFont function
- Fixed process execution bug
- Fixed thread creation bug on CachyOS with FPC
- Fixed Global Enable controls visibility in mangohudLabelClick

## NixOS Support
- Added NixOS font support
- Improved compatibility with NixOS package management

## Documentation

### New Documentation
- `CLAUDE.md`: AI assistant guidance for working with codebase
- `FLATPAK.md`: Flatpak-specific documentation (updated)
- `data/button_icons/README.md`: Comprehensive guide for adding button icons
- `THEME_SYSTEM.md`: Theme system documentation

### Updated Documentation
- Updated AppStream metadata with improved branding and screenshots
- Updated desktop file with improved description and keywords
- Revised README with project details and acknowledgments
- Replaced old screenshots with new images

## GitHub Integration

### CI/CD
- Added GitHub Actions workflow for automated Flatpak releases
- Workflow triggers on any tag
- Automated Flatpak build and release process

### Build System
- Fixed Flatpak build: resolved Qt6Pas linking issues
- Fixed compiler configuration issues
- Improved build script with versioned output filenames

## Tutorial System
- Added tutorial form with turbulence animations
- Conditional visibility for tutorial elements
- Improved first-time user experience

## Dependencies Updated
- Qt6 Platform: 6.7 → 6.10
- MangoHud: 0.8.1 → 0.8.2
- Lazarus: 3.6 → 4.4
- Git: 2.43.0 → 2.48.1
- Added: vkBasalt 0.3.2.10
- Added: SPIRV-Headers (vulkan-sdk-1.3.296.0)
- Removed: qt6-wayland (not needed)

## Notification System
- Unified notification system using D-Bus API
- Works in both Flatpak sandbox and native environments
- Fallback to notify-send if D-Bus unavailable
- Removed environment-specific notification code

## Multi-GPU Support
- Automatic detection of multiple GPUs via lspci
- Automatic addition of `gpu_list=0,1` to MangoHud config
- Better GPU enumeration and display

## Version Information
- Version bumped to 1.6.2
- Version now included in MangoHud config file headers
- Channel information (git/stable) added to headers
- Flatpak builds show channel in window caption

---

## Summary Statistics
- **Total commits since 1.6.1**: 90+
- **Major features added**: 6 (Theme System, Flatpak Support, vkBasalt Integration, Multi-GPU, New MangoHud Options, OptiScaler improvements)
- **New MangoHud options**: 7
- **Files refactored**: Multiple (overlayunit.pas, config system, path management)
- **New units added**: 3 (themeunit.pas, constants unit, systemdetector unit, configmanager unit)
- **Documentation files added/updated**: 5+
- **Bug fixes**: 15+
- **Dependencies updated**: 4
- **Dependencies added**: 2
